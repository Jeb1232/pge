#ifndef PULSE_UTIL_H_INCLUDED
#define PULSE_UTIL_H_INCLUDED

#include <doctest/doctest.h>
#include <PGE/Types/Range.h>

#define PP_NARG(...) PP_NARG_(__VA_ARGS__,PP_RSEQ_N())
#define PP_NARG_(...) PP_ARG_N(__VA_ARGS__)
#define PP_ARG_N(_1, _2, _3, _4, _5, _6, _7, _8, _9, N, ...) N
#define PP_RSEQ_N() 9, 8, 7, 6, 5, 4, 3, 2, 1

#define PULSE_ARPS1(NESTED, VAR, SUB) SUBCASE("AUTOGENERATED RECURSIVE PARAMETERIZATION " #VAR " = " #SUB) { VAR = SUB; NESTED }
#define PULSE_ARPS2(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS1(NESTED, VAR, __VA_ARGS__)
#define PULSE_ARPS3(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS2(NESTED, VAR, __VA_ARGS__)
#define PULSE_ARPS4(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS3(NESTED, VAR, __VA_ARGS__)
#define PULSE_ARPS5(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS3(NESTED, VAR, __VA_ARGS__)
#define PULSE_ARPS6(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS3(NESTED, VAR, __VA_ARGS__)
#define PULSE_ARPS7(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS3(NESTED, VAR, __VA_ARGS__)
#define PULSE_ARPS8(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS3(NESTED, VAR, __VA_ARGS__)
#define PULSE_ARPS9(NESTED, VAR, SUB, ...) PULSE_ARPS1(NESTED, VAR, SUB) PULSE_ARPS3(NESTED, VAR, __VA_ARGS__)

#define SUBCASE_PR(NESTED, VAR, ...) PGE_INTERNAL_CONCAT(PULSE_ARPS, PP_NARG(__VA_ARGS__))(NESTED, VAR, __VA_ARGS__)
#define SUBCASE_P(VAR, ...) SUBCASE_PR(, VAR, __VA_ARGS__)

#endif // PULSE_UTIL_H_INCLUDED
